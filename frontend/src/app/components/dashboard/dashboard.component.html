<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Módulo de Autenticação</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .font-monospace {
            font-family: 'Courier New', monospace;
        }
        .small {
            font-size: 0.8rem;
        }
        .card {
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .badge {
            font-size: 0.9rem;
        }
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 class="text-primary">
                        <i class="fas fa-tachometer-alt me-2"></i>
                        Dashboard - Módulo de Autenticação
                    </h2>
                    <button class="btn btn-outline-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-2"></i>
                        Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- User Info Card -->
        <div class="row mb-4">
            <div class="col-12 col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-user me-2"></i>
                            Informações do Usuário
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="loading" class="text-center d-none">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Carregando...</span>
                            </div>
                        </div>

                        <div id="error" class="alert alert-danger d-none">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <span id="errorMessage"></span>
                            <button class="btn btn-sm btn-outline-primary ms-2" onclick="loadProfile()">
                                Tentar Novamente
                            </button>
                        </div>

                        <div id="userInfo" class="row">
                            <div class="col-12">
                                <table class="table table-borderless">
                                    <tr>
                                        <td><strong>ID:</strong></td>
                                        <td id="userId">12345</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Nome:</strong></td>
                                        <td id="userName">João Silva</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Email:</strong></td>
                                        <td id="userEmail">joao.silva@empresa.com</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Perfil:</strong></td>
                                        <td>
                                            <span class="badge bg-success" id="userRole">
                                                <i class="fas fa-user"></i>
                                                Usuario
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Criado em:</strong></td>
                                        <td id="userCreatedAt">15/06/2025 14:30</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Token Info Card -->
            <div class="col-12 col-lg-6 mt-3 mt-lg-0">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-key me-2"></i>
                            Token JWT
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">
                            Use este token para testar outros módulos do sistema:
                        </p>
                        
                        <div class="input-group mb-3">
                            <input 
                                type="text" 
                                class="form-control font-monospace small" 
                                id="tokenInput"
                                value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NSIsIm5hbWUiOiJKb8OjbyBTaWx2YSIsImVtYWlsIjoiam9hby5zaWx2YUBlbXByZXNhLmNvbSIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzE5MzI4MjAwLCJleHAiOjE3MTkzMzE4MDB9.sample_token" 
                                readonly
                                style="font-size: 0.8rem;"
                            >
                            <button class="btn btn-outline-primary" type="button" onclick="copyToken()">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>

                        <div class="d-grid">
                            <button 
                                class="btn btn-outline-success" 
                                id="validateBtn"
                                onclick="testTokenValidation()"
                            >
                                <i class="fas fa-check-circle me-2"></i>
                                Testar Validação
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Token Validation Results -->
        <div class="row mb-4" id="validationResults" style="display: none;">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header" id="validationHeader">
                        <h5 class="mb-0">
                            <i class="fas fa-info-circle me-2"></i>
                            Resultado da Validação
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="validationContent">
                            <!-- Conteúdo dinâmico da validação -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- API Testing Card -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="fas fa-code me-2"></i>
                            Teste de API
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">
                            Teste chamadas para outros módulos usando seu token JWT:
                        </p>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <button class="btn btn-outline-info w-100" onclick="testApiCall('/api/profile')">
                                    <i class="fas fa-user me-2"></i>
                                    Testar /api/profile
                                </button>
                            </div>
                            <div class="col-md-6 mb-3">
                                <button class="btn btn-outline-info w-100" onclick="testApiCall('/api/protected')">
                                    <i class="fas fa-shield-alt me-2"></i>
                                    Testar /api/protected
                                </button>
                            </div>
                        </div>
                        
                        <div id="apiTestResult" class="mt-3" style="display: none;">
                            <div class="alert" id="apiAlert">
                                <pre id="apiResponse" class="mb-0"></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Stats -->
        <div class="row">
            <div class="col-md-3 mb-3">
                <div class="card text-center shadow-sm">
                    <div class="card-body">
                        <i class="fas fa-users fa-2x text-primary mb-2"></i>
                        <h5 class="card-title">Usuários Ativos</h5>
                        <h3 class="text-primary">247</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center shadow-sm">
                    <div class="card-body">
                        <i class="fas fa-key fa-2x text-success mb-2"></i>
                        <h5 class="card-title">Tokens Válidos</h5>
                        <h3 class="text-success">189</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center shadow-sm">
                    <div class="card-body">
                        <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                        <h5 class="card-title">Sessões Hoje</h5>
                        <h3 class="text-warning">1,023</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center shadow-sm">
                    <div class="card-body">
                        <i class="fas fa-chart-line fa-2x text-info mb-2"></i>
                        <h5 class="card-title">Uptime</h5>
                        <h3 class="text-info">99.9%</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Dados simulados do usuário
        let currentUser = {
            id: '12345',
            name: 'João Silva',
            email: 'joao.silva@empresa.com',
            role: 'user',
            created_at: '2025-06-15T14:30:00Z'
        };

        let sampleToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NSIsIm5hbWUiOiJKb8OjbyBTaWx2YSIsImVtYWlsIjoiam9hby5zaWx2YUBlbXByZXNhLmNvbSIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzE5MzI4MjAwLCJleHAiOjE3MTkzMzE4MDB9.sample_token_signature_here';

        // Funções principais
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                alert('Logout realizado com sucesso!');
                // Aqui você redirecionaria para a página de login
            }
        }

        function loadProfile() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const userInfo = document.getElementById('userInfo');
            
            loading.classList.remove('d-none');
            error.classList.add('d-none');
            userInfo.style.display = 'none';
            
            // Simula carregamento
            setTimeout(() => {
                loading.classList.add('d-none');
                userInfo.style.display = 'block';
                updateUserInfo();
            }, 1000);
        }

        function updateUserInfo() {
            document.getElementById('userId').textContent = currentUser.id;
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            
            const roleElement = document.getElementById('userRole');
            const isAdmin = currentUser.role === 'admin';
            
            roleElement.className = `badge ${isAdmin ? 'bg-danger' : 'bg-success'}`;
            roleElement.innerHTML = `
                <i class="fas ${isAdmin ? 'fa-crown' : 'fa-user'}"></i>
                ${currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1)}
            `;
            
            const date = new Date(currentUser.created_at);
            document.getElementById('userCreatedAt').textContent = 
                date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'});
        }

        function copyToken() {
            const tokenInput = document.getElementById('tokenInput');
            tokenInput.select();
            tokenInput.setSelectionRange(0, 99999); // Para mobile
            
            try {
                document.execCommand('copy');
                showToast('Token copiado para a área de transferência!', 'success');
            } catch (err) {
                showToast('Erro ao copiar token', 'error');
            }
        }

        function testTokenValidation() {
            const btn = document.getElementById('validateBtn');
            const resultsDiv = document.getElementById('validationResults');
            const header = document.getElementById('validationHeader');
            const content = document.getElementById('validationContent');
            
            // Atualizar botão
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Validando...';
            btn.disabled = true;
            
            // Simular validação
            setTimeout(() => {
                const isValid = Math.random() > 0.3; // 70% chance de sucesso
                
                if (isValid) {
                    header.className = 'card-header bg-info text-white';
                    header.innerHTML = '<h5 class="mb-0"><i class="fas fa-check-circle me-2"></i>Token Válido</h5>';
                    
                    content.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>
                            Token JWT validado com sucesso!
                        </div>
                        <table class="table table-sm">
                            <tr><td><strong>Emissor:</strong></td><td>auth-module</td></tr>
                            <tr><td><strong>Expira em:</strong></td><td>1 hora</td></tr>
                            <tr><td><strong>Algoritmo:</strong></td><td>HS256</td></tr>
                            <tr><td><strong>Status:</strong></td><td><span class="badge bg-success">Válido</span></td></tr>
                        </table>
                    `;
                } else {
                    header.className = 'card-header bg-danger text-white';
                    header.innerHTML = '<h5 class="mb-0"><i class="fas fa-times-circle me-2"></i>Token Inválido</h5>';
                    
                    content.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-times-circle me-2"></i>
                            Token JWT inválido ou expirado!
                        </div>
                        <p class="text-muted">Possíveis causas:</p>
                        <ul class="text-muted">
                            <li>Token expirado</li>
                            <li>Assinatura inválida</li>
                            <li>Formato incorreto</li>
                        </ul>
                    `;
                }
                
                resultsDiv.style.display = 'block';
                
                // Restaurar botão
                btn.innerHTML = '<i class="fas fa-check-circle me-2"></i>Testar Validação';
                btn.disabled = false;
            }, 2000);
        }

        function testApiCall(endpoint) {
            const resultDiv = document.getElementById('apiTestResult');
            const alert = document.getElementById('apiAlert');
            const response = document.getElementById('apiResponse');
            
            // Simular chamada de API
            const mockResponses = {
                '/api/profile': {
                    success: true,
                    data: {
                        id: currentUser.id,
                        name: currentUser.name,
                        email: currentUser.email,
                        role: currentUser.role
                    }
                },
                '/api/protected': {
                    success: Math.random() > 0.5,
                    message: Math.random() > 0.5 ? 'Acesso autorizado' : 'Token inválido'
                }
            };
            
            const mockResponse = mockResponses[endpoint] || { error: 'Endpoint não encontrado' };
            
            if (mockResponse.success !== false) {
                alert.className = 'alert alert-success';
                response.textContent = JSON.stringify(mockResponse, null, 2);
            } else {
                alert.className = 'alert alert-danger';
                response.textContent = JSON.stringify(mockResponse, null, 2);
            }
            
            resultDiv.style.display = 'block';
        }

        function showToast(message, type) {
            // Implementação simples de toast
            const toast = document.createElement('div');
            toast.className = `alert alert-${type === 'success' ? 'success' : 'danger'} position-fixed`;
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close float-end" onclick="this.parentElement.remove()"></button>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 3000);
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            updateUserInfo();
        });
    </script>
</body>
</html>